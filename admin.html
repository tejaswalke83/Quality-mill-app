
    

 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-screen flex bg-gray-100">

  <!-- Sidebar -->
  <aside class="w-64 bg-white shadow-md">
    <div class="p-4 text-xl font-bold border-b">Admin Panel</div>
    <nav class="mt-4">
      <ul>
        <li><button onclick="showSection('dashboard')" class="w-full text-left px-4 py-2 hover:bg-gray-200">Dashboard</button></li>
        <li><button onclick="showSection('config')" class="w-full text-left px-4 py-2 hover:bg-gray-200">Configurations</button></li>
        <li><button onclick="showSection('users')" class="w-full text-left px-4 py-2 hover:bg-gray-200">Users</button></li>
        <li><button onclick="showSection('societies')" class="w-full text-left px-4 py-2 hover:bg-gray-200">Societies</button></li>
        <li><button onclick="showSection('orders')" class="w-full text-left px-4 py-2 hover:bg-gray-200">Orders</button></li>
        <li><button onclick="showSection('grains')" class="w-full text-left px-4 py-2 hover:bg-gray-200">Grains</button></li>
      </ul>
    </nav>
  </aside>

  <!-- Main Content -->
  <main class="flex-1 p-6 overflow-y-auto">

    <!-- Dashboard Section -->
    <section id="section-dashboard" class="hidden">
      <h1 class="text-2xl font-bold mb-6">Dashboard Overview</h1>
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        
        <div class="bg-white p-6 rounded-lg shadow cursor-pointer" onclick="showSection('users')">
          <h2 class="text-gray-600">Total Users</h2>
          <p id="card-users" class="text-3xl font-bold mt-2">0</p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow cursor-pointer" onclick="showSection('societies')">
          <h2 class="text-gray-600">Total Societies</h2>
          <p id="card-societies" class="text-3xl font-bold mt-2">0</p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow cursor-pointer" onclick="showSection('orders')">
          <h2 class="text-gray-600">Total Orders</h2>
          <p id="card-orders" class="text-3xl font-bold mt-2">0</p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow cursor-pointer" onclick="showSection('grains')">
          <h2 class="text-gray-600">Total Grains</h2>
          <p id="card-grains" class="text-3xl font-bold mt-2">0</p>
        </div>

        <div class="bg-white p-6 rounded-lg shadow cursor-pointer" onclick="showSection('config')">
          <h2 class="text-gray-600">Active Configs</h2>
          <p id="card-configs" class="text-3xl font-bold mt-2">0</p>
        </div>
      </div>
    </section>

    <!-- Configurations Section -->
    <section id="section-config" class="hidden">
      <h1 class="text-2xl font-bold mb-4">Configuration Management</h1>
      <button onclick="openForm()" 
        class="mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        + Add Configuration
      </button>
      <table class="w-full border-collapse border border-gray-300">
        <thead class="bg-gray-200">
          <tr>
            <th class="border p-2">ID</th>
            <th class="border p-2">Key</th>
            <th class="border p-2">Value</th>
            <th class="border p-2">Description</th>
            <th class="border p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="configTable" class="text-center"></tbody>
      </table>
    </section>

    <!-- Orders Section -->
    <section id="section-orders" class="hidden">
      <h1 class="text-2xl font-bold mb-4">Order Management</h1>
      <table class="w-full border-collapse border border-gray-300">
        <thead class="bg-gray-200">
          <tr>
            <th class="border p-2">ID</th>
            <th class="border p-2">Customer ID</th>
            <th class="border p-2">Grain</th>
            <th class="border p-2">Quantity (kg)</th>
            <th class="border p-2">Price</th>
            <th class="border p-2">Order Type</th>
            <th class="border p-2">Payment</th>
            <th class="border p-2">Status</th>
            <th class="border p-2">Created</th>
            <th class="border p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="ordersTable" class="text-center"></tbody>
      </table>
    </section>

    <!-- Users Section -->
    <section id="section-users" class="hidden">
      <h1 class="text-2xl font-bold mb-4">User Management</h1>
      <p class="text-gray-600">Coming soon...</p>
    </section>

    <!-- Societies Section -->
    <section id="section-societies" class="hidden">
      <h1 class="text-2xl font-bold mb-4">Society Management</h1>
      <button onclick="openSocietyForm()" 
        class="mb-4 px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">
        + Add Society
      </button>
      <table class="w-full border-collapse border border-gray-300">
        <thead class="bg-gray-200">
          <tr>
            <th class="border p-2">ID</th>
            <th class="border p-2">Name</th>
            <th class="border p-2">Address</th>
            <th class="border p-2">Contact</th>
            <th class="border p-2">Active</th>
            <th class="border p-2">Actions</th>
          </tr>
        </thead>
        <tbody id="societyTable" class="text-center"></tbody>
      </table>
    </section>

    <!-- Grains Section -->
    <section id="section-grains" class="hidden">
      <h1 class="text-2xl font-bold mb-4">Grain Price Management</h1>
      <p class="text-gray-600">Coming soon...</p>
    </section>
  </main>

  <!-- Add/Edit Modal for Config -->
  <div id="configFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-lg w-96">
      <h2 id="formTitle" class="text-xl font-semibold mb-4">Add Config</h2>
      <input type="hidden" id="configId">

      <label class="block mb-2 text-sm font-medium">Key</label>
      <input id="configKey" type="text" class="w-full border rounded p-2 mb-4">

      <label class="block mb-2 text-sm font-medium">Value</label>
      <input id="configValue" type="text" class="w-full border rounded p-2 mb-4">

      <label class="block mb-2 text-sm font-medium">Description</label>
      <textarea id="configDesc" class="w-full border rounded p-2 mb-4"></textarea>

      <div class="flex justify-end gap-2">
        <button onclick="closeForm()" class="px-4 py-2 border rounded">Cancel</button>
        <button onclick="saveConfig()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Save</button>
      </div>
    </div>
  </div>

  <!-- Add/Edit Modal for Society -->
  <div id="societyFormModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center">
    <div class="bg-white p-6 rounded-lg w-96">
      <h2 id="societyFormTitle" class="text-xl font-semibold mb-4">Add Society</h2>
      <input type="hidden" id="societyId">

      <label class="block mb-2 text-sm font-medium">Name</label>
      <input id="societyName" type="text" class="w-full border rounded p-2 mb-4">

      <label class="block mb-2 text-sm font-medium">Address</label>
      <input id="societyAddress" type="text" class="w-full border rounded p-2 mb-4">

      <label class="block mb-2 text-sm font-medium">Contact</label>
      <input id="societyContact" type="text" class="w-full border rounded p-2 mb-4">

      <div class="flex justify-end gap-2">
        <button onclick="closeSocietyForm()" class="px-4 py-2 border rounded">Cancel</button>
        <button onclick="saveSociety()" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">Save</button>
      </div>
    </div>
  </div>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
     const supabaseUrl = 'https://odczzymxgjsjhbufffxm.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kY3p6eW14Z2pzamhidWZmZnhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMjY2NDIsImV4cCI6MjA2OTkwMjY0Mn0.T2ZT6U11taDH7vNTUJgI9xvqEZ1YEfBrNx28QV7jJvI';
  const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

    let configs = [];
    let societies = [];
    let editId = null;
    let editSocietyId = null;

    function showSection(name) {
      document.querySelectorAll("main section").forEach(s => s.classList.add("hidden"));
      document.getElementById("section-" + name).classList.remove("hidden");

      if (name === "orders") fetchOrders();
      if (name === "config") fetchConfigs();
      if (name === "societies") fetchSocieties();
    }

    // Default landing page
    showSection('dashboard');

    // ---------------- Config Section ----------------
    async function fetchConfigs() {
  const { data, error } = await supabaseClient
    .from('Configuration')   // ✅ Correct table name
    .select('*')
    .order('id');

  if (error) { console.error("Error fetching configs:", error); return; }
  configs = data;
  renderConfigTable();
}

    function renderConfigTable() {
      const tbody = document.getElementById("configTable");
      tbody.innerHTML = "";
      configs.forEach(conf => {
        tbody.innerHTML += `
          <tr>
            <td class="border p-2">${conf.id}</td>
            <td class="border p-2">${conf.config_key}</td>
            <td class="border p-2">${conf.config_value}</td>
            <td class="border p-2">${conf.description || '-'}</td>
            <td class="border p-2">
              <button onclick="editConfig(${conf.id})" class="px-2 py-1 bg-yellow-500 text-white rounded">Edit</button>
              <button onclick="deleteConfig(${conf.id})" class="px-2 py-1 bg-red-600 text-white rounded">Delete</button>
            </td>
          </tr>`;
      });
      document.getElementById("card-configs").innerText = configs.length;
    }

    function openForm() {
      document.getElementById("configFormModal").classList.remove("hidden");
      document.getElementById("formTitle").innerText = "Add Config";
      document.getElementById("configKey").value = "";
      document.getElementById("configValue").value = "";
      document.getElementById("configDesc").value = "";
      editId = null;
    }

    function closeForm() { document.getElementById("configFormModal").classList.add("hidden"); }

    async function saveConfig() {
  const key = document.getElementById("configKey").value.trim();
  const value = document.getElementById("configValue").value.trim();
  const desc = document.getElementById("configDesc").value.trim();

  if (editId) {
    await supabaseClient
      .from('Configuration')   // ✅
      .update({ config_key: key, config_value: value, description: desc })
      .eq('id', editId);
  } else {
    await supabaseClient
      .from('Configuration')   // ✅
      .insert([{ config_key: key, config_value: value, description: desc }]);
  }
}

    function editConfig(id) {
      const conf = configs.find(c => c.id === id);
      editId = id;
      document.getElementById("formTitle").innerText = "Edit Config";
      document.getElementById("configKey").value = conf.config_key;
      document.getElementById("configValue").value = conf.config_value;
      document.getElementById("configDesc").value = conf.description || "";
      document.getElementById("configFormModal").classList.remove("hidden");
    }

    async function deleteConfig(id) {
      await supabaseClient.from('Configurations').delete().eq('id', id);
      fetchConfigs();
    }

    // ---------------- Societies Section ----------------
    async function fetchSocieties() {
      const { data, error } = await supabaseClient.from('societies').select('*').order('created_at', { ascending: false });
      if (error) { console.error("Error fetching societies:", error); return; }
      societies = data;
      renderSocietyTable();
    }

    function renderSocietyTable() {
      const tbody = document.getElementById("societyTable");
      tbody.innerHTML = "";
      societies.forEach(s => {
        tbody.innerHTML += `
          <tr>
            <td class="border p-2">${s.id}</td>
            <td class="border p-2">${s.name}</td>
            <td class="border p-2">${s.address || '-'}</td>
            <td class="border p-2">${s.contact_number || '-'}</td>
            <td class="border p-2 text-center">${s.is_active ? "✅" : "❌"}</td>
            <td class="border p-2">
              <button onclick="editSociety('${s.id}')" class="px-2 py-1 bg-yellow-500 text-white rounded">Edit</button>
              <button onclick="deleteSociety('${s.id}')" class="px-2 py-1 bg-red-600 text-white rounded">Delete</button>
            </td>
          </tr>`;
      });
      document.getElementById("card-societies").innerText = societies.length;
    }

    function openSocietyForm() {
      document.getElementById("societyFormModal").classList.remove("hidden");
      document.getElementById("societyFormTitle").innerText = "Add Society";
      document.getElementById("societyName").value = "";
      document.getElementById("societyAddress").value = "";
      document.getElementById("societyContact").value = "";
      editSocietyId = null;
    }

    function closeSocietyForm() { document.getElementById("societyFormModal").classList.add("hidden"); }

    async function saveSociety() {
      const name = document.getElementById("societyName").value.trim();
      const address = document.getElementById("societyAddress").value.trim();
      const contact = document.getElementById("societyContact").value.trim();

      if (editSocietyId) {
        await supabaseClient.from('societies').update({ name, address, contact_number: contact }).eq('id', editSocietyId);
      } else {
        await supabaseClient.from('societies').insert([{ name, address, contact_number: contact }]);
      }
     closeForm();
  fetchConfigs();
    }

    function editSociety(id) {
      const s = societies.find(x => x.id === id);
      editSocietyId = id;
      document.getElementById("societyFormTitle").innerText = "Edit Society";
      document.getElementById("societyName").value = s.name;
      document.getElementById("societyAddress").value = s.address || "";
      document.getElementById("societyContact").value = s.contact_number || "";
      document.getElementById("societyFormModal").classList.remove("hidden");
    }

    async function deleteConfig(id) {
  await supabaseClient.from('Configuration').delete().eq('id', id); // ✅
  fetchConfigs();
}

    // ---------------- Orders Section ----------------
    async function fetchOrders() {
      const { data, error } = await supabaseClient.from('orders').select('*').limit(20).order('created_at', { ascending: false });
      if (error) { console.error("Error fetching orders:", error); return; }
      renderOrders(data);
    }

    function renderOrders(orders) {
      const tbody = document.getElementById("ordersTable");
      tbody.innerHTML = "";
      orders.forEach(o => {
        tbody.innerHTML += `
          <tr>
            <td class="border p-2">${o.id}</td>
            <td class="border p-2">${o.customer_id || '-'}</td>
            <td class="border p-2">${o.grain_type || '-'}</td>
            <td class="border p-2">${o.quantity_kg || '-'}</td>
            <td class="border p-2">${o.total_price || '-'}</td>
            <td class="border p-2">${o.order_type || '-'}</td>
            <td class="border p-2">${o.payment_status || '-'}</td>
            <td class="border p-2">${o.status_backup || '-'}</td>
            <td class="border p-2">${o.created_at ? new Date(o.created_at).toLocaleString() : '-'}</td>
            <td class="border p-2">
              <button onclick="deleteOrder('${o.id}')" class="px-2 py-1 bg-red-600 text-white rounded">Delete</button>
            </td>
          </tr>`;
      });
      document.getElementById("card-orders").innerText = orders.length;
    }

    async function deleteOrder(id) {
      await supabaseClient.from('orders').delete().eq('id', id);
      fetchOrders();
    }
  </script>
</body>
</html>
