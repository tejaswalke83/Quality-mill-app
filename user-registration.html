
  const supabaseUrl = 'https://odczzymxgjsjhbufffxm.supabase.com';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kY3p6eW14Z2pzamhidWZmZnhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMjY2NDIsImV4cCI6MjA2OTkwMjY0Mn0.T2ZT6U11taDH7vNTUJgI9xvqEZ1YEfBrNx28QV7jJvI';
  const supabase = createClient(supabaseUrl, supabaseKey);

 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>User Registration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 2rem;
    }

    input, select, button {
      display: block;
      margin-bottom: 1rem;
      padding: 0.5rem;
      width: 100%;
      max-width: 300px;
    }

    .error {
      color: red;
      font-size: 0.9rem;
    }

    .spinner {
      display: none;
    }

    .hidden {
      display: none;
    }

    .icon-button {
      font-size: 1.5rem;
      cursor: pointer;
      background: none;
      border: none;
    }
  </style>
</head>
<body>

  <h2>User Registration</h2>

  <!-- Initial Phone Number Input -->
  <div id="phone-form">
    <input type="text" id="phoneNumber" placeholder="Enter Mobile Number" />
    <span id="phone-error" class="error"></span>
    <button class="icon-button" onclick="checkUser()">
      ➡️
    </button>
    <div class="spinner" id="spinner">Checking...</div>
  </div>

  <!-- Extra fields if user does not exist -->
  <div id="registration-form" class="hidden">
    <input type="text" id="name" placeholder="Name" />
    <span id="name-error" class="error"></span>

    <select id="societyDropdown">
      <option value="">Select Society</option>
    </select>
    <span id="society-error" class="error"></span>

    <input type="text" id="flatNumber" placeholder="Flat Number" />
    <span id="flat-error" class="error"></span>

    <input type="text" id="wing" placeholder="Wing" />
    <span id="wing-error" class="error"></span>

    <select id="millingPreference">
      <option value="">Milling Preference</option>
      <option value="fine">Fine</option>
      <option value="medium">Medium</option>
      <option value="coarse">Coarse</option>
    </select>

    <button onclick="registerUser()">Register</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const SUPABASE_URL = 'https://odczzymxgjsjhbufffxm.supabase.com';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9kY3p6eW14Z2pzamhidWZmZnhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzMjY2NDIsImV4cCI6MjA2OTkwMjY0Mn0.T2ZT6U11taDH7vNTUJgI9xvqEZ1YEfBrNx28QV7jJvI';
    const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

    async function checkUser() {
      const phoneInput = document.getElementById('phoneNumber');
      const phone = phoneInput.value.trim();
      const errorSpan = document.getElementById('phone-error');
      const spinner = document.getElementById('spinner');

      errorSpan.textContent = '';
      document.getElementById('registration-form').classList.add('hidden');

      if (!phone || !/^\d{10}$/.test(phone)) {
        errorSpan.textContent = 'Enter a valid 10-digit number';
        return;
      }

      spinner.style.display = 'block';

      try {
        const { data, error } = await supabase
          .from('customers')
          .select('*')
          .eq('phone_number', phone)
          .single();

        spinner.style.display = 'none';

        if (data) {
          alert('Welcome back! You are already registered.');
        } else {
          await populateSocieties();
          document.getElementById('registration-form').classList.remove('hidden');
        }
      } catch (err) {
        spinner.style.display = 'none';
        console.error('Error checking user:', err);
        alert('Something went wrong while checking the user. Please try again.');
      }
    }

    async function populateSocieties() {
      try {
        const { data, error } = await supabase
          .from('societies')
          .select('*');

        if (error) throw error;

        const dropdown = document.getElementById('societyDropdown');
        dropdown.innerHTML = `<option value="">Select Society</option>`;
        data.forEach(soc => {
          const option = document.createElement('option');
          option.value = soc.name || soc.id;
          option.textContent = soc.name;
          dropdown.appendChild(option);
        });
      } catch (err) {
        console.error('Error fetching societies:', err);
        alert('Failed to load societies. Check console for details.');
      }
    }

    async function registerUser() {
      const phone = document.getElementById('phoneNumber').value.trim();
      const name = document.getElementById('name').value.trim();
      const society = document.getElementById('societyDropdown').value;
      const flat = document.getElementById('flatNumber').value.trim();
      const wing = document.getElementById('wing').value.trim();
      const milling = document.getElementById('millingPreference').value;

      // Clear all error spans
      document.querySelectorAll('.error').forEach(el => el.textContent = '');

      let hasError = false;
      if (!name) {
        document.getElementById('name-error').textContent = 'Name is required';
        hasError = true;
      }

      if (!society) {
        document.getElementById('society-error').textContent = 'Select a society';
        hasError = true;
      }

      if (!flat) {
        document.getElementById('flat-error').textContent = 'Flat number required';
        hasError = true;
      }

      if (!wing) {
        document.getElementById('wing-error').textContent = 'Wing is required';
        hasError = true;
      }

      if (hasError) return;

      try {
        const { data, error } = await supabase
          .from('customers')
          .insert([{
            phone_number: phone,
            name: name,
            society_name: society,
            flat_number: flat,
            wing: wing,
            milling_preference: milling,
            area: null,
            city: null
          }]);

        if (error) {
          console.error('Insert error:', error);
          alert('Registration failed. Check console.');
        } else {
          alert('Registered successfully!');
          location.reload();
        }
      } catch (err) {
        console.error('Unexpected error during registration:', err);
        alert('Something went wrong while registering. Please try again.');
      }
    }
  </script>
</body>
</html>
