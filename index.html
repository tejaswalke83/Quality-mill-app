<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Quality Mill - Welcome</title>

  <!-- Tailwind for consistent look -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="manifest" href="/manifest.json" />
  <meta name="theme-color" content="#0d6efd" />

  <!-- Common PWA/Push setup -->
  <script defer src="/common.js"></script>
</head>

<body class="flex flex-col justify-center items-center h-screen bg-[#3c5882] text-white">

  <!-- Logo -->
  <img src="/images/full logo.png" alt="Quality Mill Logo"
       class="w-64 sm:w-80 mb-8 opacity-0 animate-fade-in" />

  <!-- Button -->
  <button id="nextBtn"
    class="hidden bg-blue-500 hover:bg-blue-600 text-white font-semibold px-8 py-3 rounded-full shadow-lg transition-all duration-300">
    Next →
  </button>

  <!-- Smooth fade animation -->
  <style>
    @keyframes fadeIn {
      0% { opacity: 0; transform: translateY(30px); }
      100% { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in {
      animation: fadeIn 0.8s ease forwards;
    }
  </style>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.1/firebase-messaging-compat.js"></script>

  <!-- Firebase Config + Push Logic -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBpQRge5ZLaNx_mM_vwQrwmm1f2LkyhOyY",
      authDomain: "qualityattamills.firebaseapp.com",
      projectId: "qualityattamills",
      storageBucket: "qualityattamills.firebasestorage.app",
      messagingSenderId: "737428044643",
      appId: "1:737428044643:web:a0f9ecfae3794e11e57156"
    };

    firebase.initializeApp(firebaseConfig);
    const messaging = firebase.messaging();

    async function initNotifications() {
      console.log("🔔 Requesting notification permission...");
      try {
        const permission = await Notification.requestPermission();

        if (permission === "granted") {
          console.log("✅ Notification permission granted");

          // Fetch FCM Token
          const fcmToken = await messaging.getToken({
            vapidKey: "YOUR_WEB_PUSH_CERTIFICATE_KEY_PAIR_FROM_FIREBASE"
          });

          if (fcmToken) {
            console.log("📱 Token:", fcmToken);
            localStorage.setItem("fcm_token", fcmToken);
          } else {
            console.warn("⚠️ No FCM token received.");
          }
        } else {
          console.warn("🚫 Notifications blocked by user.");
        }
      } catch (err) {
        console.error("❌ Error requesting permission:", err);
      } finally {
        // ✅ Always show Next button once check completes
        document.getElementById("nextBtn").classList.remove("hidden");
      }
    }

    document.addEventListener("DOMContentLoaded", initNotifications);

    // Handle "Next" button click → go to registration
    document.getElementById("nextBtn").addEventListener("click", () => {
      const logo = document.querySelector("img");
      logo.classList.add("opacity-0", "transition-all", "duration-700");
      setTimeout(() => {
        window.location.href = "user-registration.html";
      }, 400);
    });
  </script>

</body>
</html>
